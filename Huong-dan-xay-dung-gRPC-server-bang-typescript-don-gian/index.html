<!DOCTYPE html><!--[if lte IE 8]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]--><!--[if (gte IE 9)|!(IE)]><!--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="vi-VN" lang="vi-VN"><!--<![endif]--><head><title>Hướng dẫn xây dựng gRPC server bằng typescript đơn giản - Blog Developer</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Blog Developer"><meta name="author" content="Thanh Phuong"><link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico"><link rel="alternate" href="/atom.xml" title="Blog Developer" type="application/atom+xml"><link rel="stylesheet" href="/css/all.css" media="screen" type="text/css"><link rel="amphtml" href="https://ntpntp1997.github.io/Huong-dan-xay-dung-gRPC-server-bang-typescript-don-gian//amp/index.html"><link rel="stylesheet" href="/highlightjs/vs.css" type="text/css"><link rel="canonical" href="https://ntpntp1997.github.io/huong-dan-xay-dung-grpc-server-bang-typescript-don-gian/"><meta name="keywords" content="gRPC, typescript, protobuf, nodejs"><meta name="description " content="Hẳn chúng ta ai cũng quen làm việc với các REST API. Tuy nhiên, trong môi trường microservice, việc sử dụng REST API để giao tiếp giữa các service sẽ gây ra độ trễ đáng kể. gRPC ra đời để giải quyết vấn đề này. Trong blog này mình sẽ trình bày nội dung cơ bản liên quan đến gRPC và làm một demo nhỏ để chúng ta biết cách sử dụng gRPC trong thực tế nhé."><meta property="og:title" content="Hướng dẫn xây dựng gRPC server bằng typescript đơn giản - Blog Developer"><meta property="og:url" content="https://ntpntp1997.github.io/Huong-dan-xay-dung-gRPC-server-bang-typescript-don-gian/"><meta property="og:type" content="website"><meta property="fb:app_id" content="1312420762290725"><meta property="og:description" content="Hẳn chúng ta ai cũng quen làm việc với các REST API. Tuy nhiên, trong môi trường microservice, việc sử dụng REST API để giao tiếp giữa các service sẽ gây ra độ trễ đáng kể. gRPC ra đời để giải quyết vấn đề này. Trong blog này mình sẽ trình bày nội dung cơ bản liên quan đến gRPC và làm một demo nhỏ để chúng ta biết cách sử dụng gRPC trong thực tế nhé."><meta property="og:image" content="/img/gRPC.png"><!--[if IE 8]>
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/ie8.css"
    />
  <![endif]--><script data-ad-client="ca-pub-8405511385846799" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script async src="//www.googletagmanager.com/gtag/js?id=UA-164523547-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-164523547-1")</script><script src="/js/jquery-1.11.1.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script><!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
  <![endif]--><style>.col-md-8.col-md-offset-2.opening-statement img{display:none}</style></head><body id="index" class="lightnav animsition"><div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling"><div class="sb-close" aria-label="Close Menu" aria-hidden="true"><img src="/img/close.png" alt="Close"></div><ul class="sb-menu"><li><a href="/" class="animsition-link" title="Home">Home</a></li><li><a href="/archives" class="animsition-link" title="archive">archives</a></li><li><a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a><ul class="sb-submenu"><li><a href="http://sum.services/" rel="external nofollow noreferrer" target="_BLANK" class="animsition-link">Sum Services</a></li></ul></li><li><a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a><ul class="sb-submenu"><li><a href="/categories/Framework/Developer/" class="animsition-link">Developer<small>(1)</small></a></li><li><a href="/categories/Docker/" class="animsition-link">Docker<small>(1)</small></a></li><li><a href="/categories/Framework/" class="animsition-link">Framework<small>(2)</small></a></li><li><a href="/categories/Framework/gRPC/TypeScript/NodeJs/" class="animsition-link">NodeJs<small>(1)</small></a></li><li><a href="/categories/Framework/gRPC/TypeScript/" class="animsition-link">TypeScript<small>(1)</small></a></li><li><a href="/categories/Framework/gRPC/" class="animsition-link">gRPC<small>(1)</small></a></li></ul></li><li><a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a><ul class="sb-submenu"><li><a href="https://www.facebook.com/nguyenthanhphuong.ntp" target="_blank" rel="external nofollow noreferrer noopener" class="animsition-link">My Facebook</a></li></ul></li></ul><ul class="sb-menu secondary"><li><a href="javascript:;" rel="external nofollow noreferrer" class="popup-trigger" title="Search"><span class="search-icon"></span>Search</a></li><li><a href="/about/index.html" class="animsition-link" title="about">About</a></li><li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li></ul></div><div id="sb-site"><div id="navigation" class="navbar navbar-fixed-top"><div class="navbar-inner"><div class="container"><div class="logo"><a href="/" title="Logo" class="animsition-link"><img src="/img/logo.png" alt="Logo" width="35px;"></a></div><nav><ul class="nav"><li><a href="/" class="animsition-link">Blog Developer</a></li><li class="nolink"><span>Always </span>Creative.</li><li><a href="https://github.com/ntpntp1997" rel="external nofollow noreferrer" title="Github" target="_blank"><i class="icon-github"></i></a></li><li><a href="https://www.facebook.com/nguyenthanhphuong.ntp" rel="external nofollow noreferrer" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li><li class="nolink"><span>Welcome!</span></li></ul></nav></div><div class="learnmore sb-toggle-right">More</div><button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More"><span class="sr-only">Toggle navigation</span> <span class="icon-bar before"></span> <span class="icon-bar main"></span> <span class="icon-bar after"></span></button></div></div></div><div class="post-banner-header"><img src="/img/gRPC.png" alt="thumnail"></div><section id="intro"><div class="container"><div class="row col-md-offset-2"><div class="col-md-8"><span class="post-meta"><time datetime="2020-04-28T06:21:02.000Z" itemprop="datePublished">2020-04-28 </time>| <a href="/tags/TypeScript/">TypeScript</a>, <a href="/tags/gRPC/">gRPC</a></span><h1>Hướng dẫn xây dựng gRPC server bằng typescript đơn giản</h1></div></div><div class="col-md-8 col-md-offset-2"><p>Dạo này mình làm một dự án microservices và có gặp phải các vấn đề về giao tiếp giữa các service trong khối microservices với nhau. Sau thời gian nghiên cứu và tìm hiểu thì gRPC là một giải pháp khá tốt cho vấn đề này. nên hôm nay mình sẻ chia sẻ cho các bạn cách sử dụng gRPC trong Typescript.</p><p>Hẳn chúng ta ai cũng quen làm việc với các REST API. Tuy nhiên, trong môi trường microservice, việc sử dụng REST API để giao tiếp giữa các service sẽ gây ra độ trễ đáng kể. gRPC ra đời để giải quyết vấn đề này. Trong blog này mình sẽ trình bày nội dung cơ bản liên quan đến gRPC và làm một todo list app demo để chúng ta biết cách sử dụng gRPC trong thực tế nhé.</p><h2 id="gRPC-la-gi"><a href="#gRPC-la-gi" class="headerlink" title="gRPC là gì ???"></a>gRPC là gì ???</h2><p>gRPC là một RPC platform được phát triển bởi Google nhằm tối ưu hoá và tăng tốc việc giao tiếp giữa các service với nhau trong kiến trúc microservice.</p><p>gRPC dùng Protocal Buffer giảm kích thước request và response data, RPC để đơn giản hoá trong việc tạo ra các giao tiếp giữa các service với nhau, HTTP/2 để tăng tốc gửi/nhận HTTP request.</p><p>Có thể hiểu nôm na gRPC là tương tự như REST dùng để giao tiếp giữa các service, tuy nhiên tốc độ gRPC nhanh hơn REST rất nhiều, bù lại gRPC khó sử dụng và rườm rà hơn. Bạn chỉ nên sử dụng gRPC khi có vấn đề về độ trễ trong việc giao tiếp giữa các service trong kiến trúc microservice.</p><h3 id="Tai-sao-nen-su-dung-gRPC"><a href="#Tai-sao-nen-su-dung-gRPC" class="headerlink" title="Tại sao nên sử dụng gRPC ???"></a>Tại sao nên sử dụng gRPC ???</h3><p>Vấn đề là gì và tại sao cần nó ?</p><p>RPC có thể được xem là một giao thức request-respone thông thường tuy nhiên nó được dùng cho việc giao tiếp giữa các server với nhau (server-server) nhiều hơn là client-server. Việc này có ý nghĩa rất quan trọng vì trong các hệ thống phân tán (distributed system), application code ở nhiều server hơn là một server. Ví dụ thường thấy nhất chính là kiến trúc Microservices.</p><p>Điều này nghĩa là: một request phía client có thể sẽ phải cần nhiều service chạy trên các server này để tổng hợp thông tin rồi mới response cho client. Sự liên lạc giữa các server lúc này sẽ là vấn đề mà trước đó tất cả service chạy trên 1 server thì khoẻ re, vì local call nên chẳng ngại gì cả. Chính xác là khi đó, khi một server muốn “nói chuyện” với server khác sẽ cần phải encode data (JSON, XML), phía nhận cũng phải làm công việc ngược lại là decode data mới hiểu thằng kia nói gì với mình rôi lại phải encode lại tiếp. Việc này tiêu tốn khá nhiều tài nguyên xử lý (CPU) mà lẽ ra chỉ cần làm ở bước đầu và cuối (đầu nhận và trả về cuối cùng).</p><p>Tối ưu cho việc “giao tiếp” giữa các server là lý do gRPC ra đời.</p><p>Để giải bài toán trên, gRPC đã sử dụng binary để truyền đi thay vì phải encode chúng thành các ngôn ngữ trung gian JSON/XML. Việc này rõ ràng đã làm tăng tốc giao tiếp các servers lên rất nhiều, giảm overhead cho CPUs. Google cũng “tiện tay” làm luôn cả protobuf (protocol buffers), đây là ngôn ngữ mà gRPC dùng như một default serialization format. Implement phần này thật sự phải là tay to lắm nên Google xử dụng protobuf như một script trung gian để generate phần hard core cho các dev ở các ngôn ngữ phổ biến như: C++, C#, Go, Java, Pyhon.</p><p>Thứ giúp gRPC giao tiếp binary ngon vậy chính là http/2, đây vốn là giao thức có rất nhiều cải tiến so với http/1.1. Bản thân http/2 cũng được coi như là sự thay thế cho SPDY, giao thức mà cũng chính Google phát triển, open source vào 2012 và ngừng hỗ trợ vào 2015 (http/2 có implement và thay thế rồi).</p><p><a href="https://viblo.asia/p/grpc-no-la-gi-va-co-nen-su-dung-hay-khong-gDVK2mAj5Lj" target="_blank" rel="noopener external nofollow noreferrer">Tham khảo thêm tại đây</a></p><h2 id="Xay-dung-gRPC-server-bang-Typescript"><a href="#Xay-dung-gRPC-server-bang-Typescript" class="headerlink" title="Xây dựng gRPC server bằng Typescript"></a>Xây dựng gRPC server bằng Typescript</h2><h3 id="Settup-mot-project-Typescript"><a href="#Settup-mot-project-Typescript" class="headerlink" title="Settup một project Typescript"></a>Settup một project Typescript</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir ts-grpc</span><br></pre></td></tr></table></figure><p>Khởi tạo một thư mục trống.</p><p>Và cấu trúc thư mục sẽ có dạng như sau.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist/                            <span class="comment"># Compiled files</span></span><br><span class="line">├── src/                             <span class="comment"># Source files</span></span><br><span class="line">│   ├── handlers/                    <span class="comment"># gRPC service handlers</span></span><br><span class="line">|   │   └── greeter.ts               <span class="comment"># Greeter service definitions</span></span><br><span class="line">│   ├── proto/                       <span class="comment"># Proto files</span></span><br><span class="line">│   │   ├── greeter/                 <span class="comment"># Greeter gRPC service</span></span><br><span class="line">│   │   │   └── greeter.proto</span><br><span class="line">│   │   ├── index.ts                 <span class="comment"># Registers all the proto typescript definitions</span></span><br><span class="line">│   └── server.ts                    <span class="comment"># Bootstrap server, add middleware (logs, graphql...)</span></span><br><span class="line">├── scripts/                         <span class="comment"># Generation tools</span></span><br><span class="line">│   └── protoc.sh                    <span class="comment"># Script to generate protoc typescript definitions</span></span><br><span class="line">└── ...</span><br></pre></td></tr></table></figure><p>bây giờ chúng ta tiến hành cài đặt các dependencies cần thiết</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install grpc google-protobuf dotenv</span><br><span class="line">npm install typescript @types/node @types/google-protobuf @types/dotenv --save-dev</span><br></pre></td></tr></table></figure><p>Đây là các package chúng ta cài</p><ul><li>grpc để dùng gRPC với Node.js</li><li>google-protobuf để dùng Protocol Buffers (.proto) với javascript</li><li>dotenv để load các biến môi trường từ file .env</li><li>TypeScript và các gói mở rộng của typescript để dịch các package trên</li></ul><p>Chúng ta sẽ khởi tạo project typescript với lệnh:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx tsc --init</span><br></pre></td></tr></table></figure><p>Sau khi chạy lệnh này xong chúng ta sẽ có file <strong>tsconfig.json</strong> như sau:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"outDir"</span>: <span class="string">"./dist/"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"allowJs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"es6"</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"include"</span>: [<span class="string">"./src/**/*"</span>],</span><br><span class="line">  <span class="attr">"exclude"</span>: [<span class="string">"node_modules"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bây giờ mở file <strong>greeter.proto</strong> thêm code sau đây</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> greeter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The greeting service definition.</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Sends a greeting</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello (HelloRequest) <span class="keyword">returns</span> (HelloResponse)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user's name.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloResponse</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> <span class="class"><span class="keyword">message</span> = 1;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure><p>Nó sẽ tạo ra một service SayHello có kiểu dữ liệu request là HelloRequest với một trường dữ liệu là name và trả về một response với kiểu dữ liệu là HelloResponse. Bạn có thể xem thêm cú pháp syntax về proto 3 tại đây <a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank" rel="noopener external nofollow noreferrer">https://developers.google.com/protocol-buffers/docs/proto</a>.</p><h3 id="Generating-TypeScript-definitions"><a href="#Generating-TypeScript-definitions" class="headerlink" title="Generating TypeScript definitions"></a>Generating TypeScript definitions</h3><p>Bây giờ chúng ta sẽ tạo ra các TypeScript definitions hỗ trợ cho gRPC service được khai báo trong file proto. Chúng ta sẽ tiến hành dịch file <strong>greeter.proto</strong> thành các class typescript có thể hiểu và sử dụng.</p><p>Chúng ta sẽ cài thêm các dependencies:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install grpc-tools grpc_tools_node_protoc_ts --save-dev</span><br></pre></td></tr></table></figure><p>Here we installed few more dev dependencies</p><ul><li>grpc-tools tạo javascript files cho proto files</li><li>grpc_tools_node_protoc_ts tạo các file module typescript tương ứng d.ts</li></ul><p>Sau khi cài các package xong, chúng ta sẽ tiến hành viết bash script để dịch file src/proto/.proto. Mở file <strong>protoc.sh</strong> và thêm code sau.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">BASEDIR=$(dirname <span class="string">"<span class="variable">$0</span>"</span>)</span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$&#123;BASEDIR&#125;</span>"</span>/../</span><br><span class="line"></span><br><span class="line">PROTOC_GEN_TS_PATH=<span class="string">"./node_modules/.bin/protoc-gen-ts"</span></span><br><span class="line">GRPC_TOOLS_NODE_PROTOC_PLUGIN=<span class="string">"./node_modules/.bin/grpc_tools_node_protoc_plugin"</span></span><br><span class="line">GRPC_TOOLS_NODE_PROTOC=<span class="string">"./node_modules/.bin/grpc_tools_node_protoc"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> ./src/proto/*; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># skip the non proto files</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$(basename "$f")</span>"</span> == <span class="string">"index.ts"</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># loop over all the available proto files and compile them into respective dir</span></span><br><span class="line">  <span class="comment"># JavaScript code generating</span></span><br><span class="line">  <span class="variable">$&#123;GRPC_TOOLS_NODE_PROTOC&#125;</span> \</span><br><span class="line">      --js_out=import_style=commonjs,binary:<span class="string">"<span class="variable">$&#123;f&#125;</span>"</span> \</span><br><span class="line">      --grpc_out=<span class="string">"<span class="variable">$&#123;f&#125;</span>"</span> \</span><br><span class="line">      --plugin=protoc-gen-grpc=<span class="string">"<span class="variable">$&#123;GRPC_TOOLS_NODE_PROTOC_PLUGIN&#125;</span>"</span> \</span><br><span class="line">      -I <span class="string">"<span class="variable">$&#123;f&#125;</span>"</span> \</span><br><span class="line">      <span class="string">"<span class="variable">$&#123;f&#125;</span>"</span>/*.proto</span><br><span class="line"></span><br><span class="line">  <span class="variable">$&#123;GRPC_TOOLS_NODE_PROTOC&#125;</span> \</span><br><span class="line">      --plugin=protoc-gen-ts=<span class="string">"<span class="variable">$&#123;PROTOC_GEN_TS_PATH&#125;</span>"</span> \</span><br><span class="line">      --ts_out=<span class="string">"<span class="variable">$&#123;f&#125;</span>"</span> \</span><br><span class="line">      -I <span class="string">"<span class="variable">$&#123;f&#125;</span>"</span> \</span><br><span class="line">      <span class="string">"<span class="variable">$&#123;f&#125;</span>"</span>/*.proto</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>Phân quyền cho file <strong>protoc.sh</strong> bằng lệnh sau.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x ./scripts/protoc.sh</span><br></pre></td></tr></table></figure><p>Bây giờ chạy script trên và nó sẽ tao các javascript file trong src/proto/greeter. Mỗi khi chỉnh sửa proto file bạn hãy nhớ chạy lại lệnh này để update các javascript file.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/protoc.sh</span><br></pre></td></tr></table></figure><p>Sau đó mở file <strong>src/proto/index.ts</strong> và thêm code sau</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./greeter/greeter_pb'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./greeter/greeter_grpc_pb'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> protoIndex: any = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;&#125;;</span><br></pre></td></tr></table></figure><p>Nhớ là bạn luôn phải update file này khi tạo ra các proto file mới .</p><h3 id="Tao-handlers"><a href="#Tao-handlers" class="headerlink" title="Tạo handlers"></a>Tạo handlers</h3><p>Chúng ta sẽ viết hàm xử lý cho SayHello service, hãy mở src/handlers/greeter.ts thêm code này.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> grpc <span class="keyword">from</span> <span class="string">'grpc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; HelloRequest, HelloResponse &#125; <span class="keyword">from</span> <span class="string">'./proto/greeter/greeter_pb'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  GreeterService,</span><br><span class="line">  IGreeterServer,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./proto/greeter/greeter_grpc_pb'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreeterHandler</span> <span class="title">implements</span> <span class="title">IGreeterServer</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">_ Greet the user nicely</span></span><br><span class="line"><span class="comment">_ <span class="doctag">@param <span class="variable">call</span></span></span></span><br><span class="line"><span class="comment">_ <span class="doctag">@param <span class="variable">callback</span></span></span></span><br><span class="line"><span class="comment">_</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  sayHello = (</span><br><span class="line">    call: grpc.ServerUnaryCall&lt;HelloRequest&gt;,</span><br><span class="line">    callback: grpc.sendUnaryData&lt;HelloResponse&gt;</span><br><span class="line">  ): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reply: HelloResponse = <span class="keyword">new</span> HelloResponse();</span><br><span class="line"></span><br><span class="line">    reply.setMessage(<span class="string">`Hello, <span class="subst">$&#123;call.request.getName()&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    callback(<span class="literal">null</span>, reply);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  service: GreeterService, <span class="comment">// Service interface</span></span><br><span class="line">  handler: <span class="keyword">new</span> GreeterHandler(), <span class="comment">// Service interface definitions</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>chúng ta sẽ thấy method sayHello được implement SayHello rpc service. lấy dữ liệu name từ request HelloRequest và chuyễn thành một câu chào kiểu HelloResponse và trả về</p><h3 id="Khoi-tao-server"><a href="#Khoi-tao-server" class="headerlink" title="Khởi tạo server"></a>Khởi tạo server</h3><p>Bây giờ chúng ta sẽ khởi tạo gRPC server. Mở file src/server.ts và thêm code:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dotenv/config'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> grpc <span class="keyword">from</span> <span class="string">'grpc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; protoIndex &#125; <span class="keyword">from</span> <span class="string">'./proto'</span>;</span><br><span class="line"><span class="keyword">import</span> greeterHandler <span class="keyword">from</span> <span class="string">'./handlers/greeter'</span>;</span><br><span class="line"></span><br><span class="line">protoIndex();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port: string | number = process.env.PORT || <span class="number">50051</span>;</span><br><span class="line"></span><br><span class="line">type StartServerType = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> startServer: StartServerType = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create a new gRPC server</span></span><br><span class="line">  <span class="keyword">const</span> server: grpc.Server = <span class="keyword">new</span> grpc.Server();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// register all the handler here...</span></span><br><span class="line">  server.addService(greeterHandler.service, greeterHandler.handler);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// define the host/port for server</span></span><br><span class="line">  server.bindAsync(</span><br><span class="line">    <span class="string">`0.0.0.0:<span class="subst">$&#123;port&#125;</span>`</span>,</span><br><span class="line">    grpc.ServerCredentials.createInsecure(),</span><br><span class="line">    (err: <span class="built_in">Error</span>, <span class="attr">port</span>: number) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`gRPC listening on <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// start the gRPC server</span></span><br><span class="line">  server.start();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">startServer();</span><br></pre></td></tr></table></figure><p>Ok, chúng ta đã tạo ra các instance của greeter service, đăng ký greeter service handler và chạy server.</p><h3 id="Kiem-tra-xem-nao"><a href="#Kiem-tra-xem-nao" class="headerlink" title="Kiểm tra xem nào"></a>Kiểm tra xem nào</h3><p>Trước tiên mở file <strong>package.json</strong> thêm các lệnh sau vào phần script:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">"scripts": &#123;</span><br><span class="line">    "build": "npx tsc --skipLibCheck",</span><br><span class="line">    "start": "npx tsc --skipLibCheck &amp;&amp; node ./dist/server.js"</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Ok chạy thử nào!!!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure><p>Ok bây giờ chúng ta có một server gRPC chạy trên port 50051</p><p>Để test gRPC các bạn hãy dùng <strong>BloomRPC</strong> Đây là một GUI tương tữ như <strong>Postman</strong> nhưng dùng cho các api bằng gRPC. Để cài đặt các bạn xem hướng dẫn <a href="https://github.com/uw-labs/bloomrpc" target="_blank" rel="noopener external nofollow noreferrer">tại đây</a>.</p><p><img src="https://i.imgur.com/bsvIC1U.png" alt=""></p><p>OK để test chúng ta hãy bắt đầu làm như sau, import greeter.proto file, đổi URL thành 127.0.0.1:50051 và click vào icon play để tận hưởng =]]]] chúc các bạn thành công.</p><p>Source code của bài viết này được cập nhật tại đây : <a href="https://github.com/ntpntp1997/gRPC-server-typescript" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/ntpntp1997/gRPC-server-typescript</a></p><div class="clearfix"></div><hr class="nogutter"></div><nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination"><a class="pull-left" href="/Huong-dan-xay-dung-docker-image-cho-NodeJs-mot-cach-toi-uu/" style="float:left">← Hướng dẫn xây dựng docker image cho NodeJs một cách tối ưu </a><a class="pull-right" href="/Huong-dan-xay-dung-mot-trang-blog-ca-nhan-don-gian-bang-Hexo-va-deploy-len-github/">Hướng dẫn xây dựng một trang blog cá nhân đơn giản bằng Hexo và deploy lên github →</a></nav><div class="col-md-8 col-md-offset-2 col-sm-24"><div id="fb-root"></div><script>!function(e,t,o){var n,r=e.getElementsByTagName(t)[0];e.getElementById(o)||((n=e.createElement(t)).id=o,n.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1&appId=1312420762290725&autoLogAppEvents=1&colorscheme=dark&order_by=time",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk")</script><section id="comments"><div class="fb-comments" data-href="
https://ntpntp1997.github.io/Huong-dan-xay-dung-gRPC-server-bang-typescript-don-gian/" data-numposts="10"></div></section></div></div></section><footer><div class="container"><div class="copy"><p>&copy; 2014<script>2010<(new Date).getFullYear()&&document.write("-"+(new Date).getFullYear())</script>, Content By Thanh Phuong. All Rights Reserved.</p><p>Theme By <a href="//go.kieran.top" target="_blank" rel="noopener" style="color:#767d84">Kieran</a></p></div><div class="social"><ul><li><a href="https://github.com/ntpntp1997" rel="external nofollow noreferrer" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li><li><a href="https://www.facebook.com/nguyenthanhphuong.ntp" rel="external nofollow noreferrer" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li></ul></div><div class="clearfix"></div></div></footer><script type="text/javascript">var resizeHero=function(){var e=$(".cover,.heightblock"),i=$(window);e.css({height:i.height()})};resizeHero(),$(window).resize(function(){resizeHero()})</script><script src="/js/plugins.min.js"></script><script src="/js/scripts.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">$("#intro").find("img").each(function(){var a=this.alt;a&&$(this).after('<span class="caption" style="display:none">'+a+"</span>"),$(this).wrap('<a href="'+this.src+'" title="'+a+'" class="fancybox" rel="gallery" />')}),jQuery(".fancybox").fancybox()</script><style>.local-search-popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;padding:0;background:rgba(255,255,255,.9);color:#333;z-index:9999;border-radius:5px;overflow:scroll}#local-search-input{width:100%;border:none;outline:0;border-bottom:1px solid #151515;background-color:initial}.search-result-list{list-style:none;padding-left:0}.search-result-list>li{margin-top:15px;border-bottom:1px solid #ddd;transition:all ease .3s}.search-result-list>li:hover{border-bottom:1px solid gray}.search-result-title{font-size:16px}.search-result{line-height:20px}.search-keyword{font-weight:400;color:#c00}@media (min-width:890px){.popup-btn-close{position:absolute;top:15px;left:35px;border:1px solid #151515;padding:0 10px;border-top-left-radius:8px;cursor:pointer;transition:all ease .3s}.popup-btn-close:hover{background:#151515;opacity:.9;color:#fff}}@media (max-width:890px){.popup-btn-close{font-size:0;position:fixed;right:20px;bottom:50px;width:50px;height:50px;background:#fff;border-radius:50%;box-shadow:1px 1px 5px #888;cursor:pointer}.popup-btn-close::after{content:'←';color:#151515;position:absolute;top:0;left:0;font-size:20px;width:100%;height:100%;line-height:50px;text-align:center}}</style><div class="popup search-popup local-search-popup"><span class="popup-btn-close">ESC</span><div class="container"><div class="col-md-8 col-md-offset-2"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="Search..." type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></div><script src="/js/ziploader.js"></script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // get search zip version
    $.get('/searchVersion.txt?t=' + (+new Date()), function(res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson () {
      initLoad(['/search.zip'], {
        loadOptions: {
          success: function(obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function(e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions:{
          'json':'application/json'
        }
      })
    }


    // search function;
    var searchFunc = function(search_id, content_id) {
      'use strict';

      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function() {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function(data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title ? data.title.trim() : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content ? data.content.trim().replace(/<[^>]+>/g,"") : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);
            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function(keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0, position = [], index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }

              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }

            // show search results

            if (isMatch) {
              // sort index by position of keyword

              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });

              // merge hits into slices

              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;

                  // move to next position of hit

                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {
                  hits: hits,
                  start: start,
                  end: end,
                  searchTextCount: searchTextCountInSlice
                };
              }

              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }

              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if(start < 0){
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if(end > content.length){
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }

              // sort slices in content by search text's count and hits' count

              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });

              // select top N slices in content

              var upperBound = parseInt('2');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }

              // highlight title and content

              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }

              var resultItem = '';

              if (slicesOfTitle.length != 0) {
                resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
              } else {
                resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
              }

              slicesOfContent.forEach(function (slice) {
                resultItem += "<a target='_blank' href='" + articleUrl + "'>" +
                  "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                  "...</p>" + "</a>";
              });

              resultItem += "</li>";
              resultItems.push({
                item: resultItem,
                searchTextCount: searchTextCount,
                hitCount: hitCount,
                id: resultItems.length
              });
            }
          })
        };
        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<ul class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</ul>";
          resultContent.innerHTML = searchResultList;
        }
      }

      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }

      // remove loading animation
      $('body').css('overflow', '');

      proceedsearch();
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        $('.sb-close').click();
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script>((window.gitter={}).chat={}).options={room:"ntpntp1997-github-io/techtalk"}</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = 'https://cdn.webpushr.com/app.min.js';fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BGIF-nevndimBG_qolCIfvKkPCEB1lX8orFiANy1SyN09kDtwmdEb_zer0UqBSwRWcCoWjOM7ObLl6zMqXl58YA');</script></body></html>